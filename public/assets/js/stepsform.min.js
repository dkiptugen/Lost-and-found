/**
 * stepsForm.js v1.0.0
 * http://www.codrops.com
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 * 
 * Copyright 2014, Codrops
 * http://www.codrops.com
 */(function(e){"use strict";function i(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function s(e,t){this.el=e;this.options=i({},this.options);i(this.options,t);this._init()}var t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},n=t[Modernizr.prefixed("transition")],r={transitions:Modernizr.csstransitions};s.prototype.options={onSubmit:function(){return!1}};s.prototype._init=function(){this.current=0;this.questions=[].slice.call(this.el.querySelectorAll("ol.questions > li"));this.questionsCount=this.questions.length;classie.addClass(this.questions[0],"current");this.ctrlNext=this.el.querySelector("button.next");this.progress=this.el.querySelector("div.progress");this.questionStatus=this.el.querySelector("span.number");this.currentNum=this.questionStatus.querySelector("span.number-current");this.currentNum.innerHTML=Number(this.current+1);this.totalQuestionNum=this.questionStatus.querySelector("span.number-total");this.totalQuestionNum.innerHTML=this.questionsCount;this.error=this.el.querySelector("span.error-message");this._initEvents()};s.prototype._initEvents=function(){var e=this,t=this.questions[this.current].querySelector("input"),n=function(){t.removeEventListener("focus",n);classie.addClass(e.ctrlNext,"show")};t.addEventListener("focus",n);this.ctrlNext.addEventListener("click",function(t){t.preventDefault();e._nextQuestion()});document.addEventListener("keydown",function(t){var n=t.keyCode||t.which;if(n===13){t.preventDefault();e._nextQuestion()}});this.el.addEventListener("keydown",function(e){var t=e.keyCode||e.which;t===9&&e.preventDefault()})};s.prototype._nextQuestion=function(){if(!this._validade())return!1;this.current===this.questionsCount-1&&(this.isFilled=!0);this._clearError();var e=this.questions[this.current];++this.current;this._progress();if(!this.isFilled){this._updateQuestionNumber();classie.addClass(this.el,"show-next");var t=this.questions[this.current];classie.removeClass(e,"current");classie.addClass(t,"current")}var i=this,s=function(e){r.transitions&&this.removeEventListener(n,s);if(i.isFilled)i._submit();else{classie.removeClass(i.el,"show-next");i.currentNum.innerHTML=i.nextQuestionNum.innerHTML;i.questionStatus.removeChild(i.nextQuestionNum);t.querySelector("input").focus()}};r.transitions?this.progress.addEventListener(n,s):s()};s.prototype._progress=function(){this.progress.style.width=this.current*(100/this.questionsCount)+"%"};s.prototype._updateQuestionNumber=function(){this.nextQuestionNum=document.createElement("span");this.nextQuestionNum.className="number-next";this.nextQuestionNum.innerHTML=Number(this.current+1);this.questionStatus.appendChild(this.nextQuestionNum)};s.prototype._submit=function(){this.options.onSubmit(this.el)};s.prototype._validade=function(){var e=this.questions[this.current].querySelector("input").value;if(e===""){this._showError("EMPTYSTR");return!1}return!0};s.prototype._showError=function(e){var t="";switch(e){case"EMPTYSTR":t="Please fill the field before continuing";break;case"INVALIDEMAIL":t="Please fill a valid email address"}this.error.innerHTML=t;classie.addClass(this.error,"show")};s.prototype._clearError=function(){classie.removeClass(this.error,"show")};e.stepsForm=s})(window);